# aws-lambda-recepie.yaml
name: aws-lambda
description: Deploy to AWS Lambda
provider: aws
service: lambda

required_fields:
  - name: region
    description: AWS region to deploy to
    type: string
    default: us-east-1

  - name: project
    description: Project name
    type: string
    default: my-project

  - name: stack_name
    description: CloudFormation stack name
    type: string
    default: my-stack

optional_fields:
  - name: lambda.memory
    description: Memory in MB
    type: int
    default: "128"

  - name: lambda.timeout
    description: Timeout in seconds
    type: int
    default: "30"

  - name: lambda.runtime
    description: Lambda runtime (e.g., provided.al2023, python3.12)
    type: string
    default: "provided.al2023"

steps:
  - name: build
    command: ["sam", "build"]
    execution_mode: service_dir
    timeout: 120
    tags:
      - build

  - name: package
    command: ["sam", "package", "--s3-bucket", "${project}-deployments", "--region", "${region}"]
    execution_mode: service_dir
    timeout: 180
    tags:
      - push

  - name: deploy
    command: ["sam", "deploy", "--stack-name", "${name}", "--region", "${region}", "--no-confirm-changeset"]
    execution_mode: service_dir
    timeout: 240
    retries: 1
    tags:
      - deploy
